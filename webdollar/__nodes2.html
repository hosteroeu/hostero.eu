<html>

<head>
  <title>WebDollar Nodes</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/async/2.6.0/async.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/dt-1.10.16/rg-1.0.2/rr-1.2.3/datatables.min.css" />
  <script type="text/javascript" src="https://cdn.datatables.net/v/dt/dt-1.10.16/rg-1.0.2/rr-1.2.3/datatables.min.js"></script>
  <script type="text/javascript" src=" https://unpkg.com/simple-statistics@6.0.0/dist/simple-statistics.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>

<body>
  <div class="container">
    <br />
    <div class="alert alert-secondary" role="alert">
      SUM: <strong><span id="sum">0</span> WEBD</strong> | MEAN: <strong><span id="mean">0</span> WEBD</strong> | MEDIAN: <strong><span id="median">0</span> WEBD</strong> | ~POWER: <strong><span id="power">0</span> Kh/s</strong> | GLOBAL: <strong><span id="global_power">0</span> Kh/s</strong>      | Chance/Dominance: <strong><span id="dominance">0</span>%</strong> | Block Time: <strong><span id="block_time">0</span> s</strong> | ~Block Mining Time: <strong><span id="block_mining_time">0</span> s / <span id="block_mining_time_minutes">0</span> m</strong>      | Current Time: <strong><span id="current_time">00:00</span></strong>
    </div>

    <p><i>*</i> Means hardcoded values. <i>~</i> Means estimated values. <i>Chance</i> Means probability to get reward at each block.</p>

    <p>Projections:
      <ul>
        <li>24 hour reward <strong><span id="reward_24">0</span></strong> WEBD / <strong><span id="reward_24_usd">0</span></strong> USD</li>
        <li>24 hour cost <strong><span id="cost_24_usd">0</span></strong> USD</li>
        <li>24 hour ROI <strong><span id="roi_24">0</span></strong>%</li>
      </ul>
    </p>

    <p>
      <table id="nodes" class="table table-striped table-bordered">
        <thead>
          <tr>
            <th>Server</th>
            <th>Amount</th>
            <th>Block</th>
          </tr>
        </thead>
      </table>
    </p>

    <p><textarea id="wallets" cols="100" rows="10"></textarea></p>
  </div>

  <script type="text/javascript">
    var nodes =
      "[\"http://18.219.182.152:65130\",\"http://18.219.182.152:65503\",\"http://18.219.182.152:57513\",\"http://18.219.182.152:58097\",\"http://18.219.182.152:57439\",\"http://18.219.182.152:57100\",\"http://18.219.182.152:64619\",\"http://18.219.182.152:64690\",\"http://18.219.182.152:62251\",\"http://18.219.182.152:56888\",\"http://18.219.182.152:65247\",\"http://18.219.182.152:60630\",\"http://18.219.182.152:64327\",\"http://18.219.182.152:63811\",\"http://18.219.182.152:58848\",\"http://18.219.182.152:58007\",\"http://167.99.88.239:51516\",\"http://46.101.75.208:52813\",\"http://46.101.75.208:54055\",\"http://46.101.75.208:57798\",\"http://159.65.95.213:50215\",\"http://159.65.95.213:54257\",\"http://159.65.95.213:59233\",\"http://159.65.95.213:54367\",\"http://159.65.87.76:56289\",\"http://159.65.87.76:50092\",\"http://159.65.87.76:63452\",\"http://167.99.88.239:63023\",\"http://159.65.87.76:62380\",\"http://167.99.80.35:50324\",\"http://167.99.80.35:63370\",\"http://167.99.80.35:58768\",\"http://167.99.80.35:49256\",\"http://167.99.88.111:56819\",\"http://167.99.88.111:53715\",\"http://167.99.88.111:56579\",\"http://167.99.88.111:59284\",\"http://159.65.93.219:64404\",\"http://167.99.88.239:56358\",\"http://159.65.93.219:56880\",\"http://159.65.93.219:51069\",\"http://159.65.93.219:52290\",\"http://46.101.87.17:55716\",\"http://46.101.87.17:63764\",\"http://46.101.87.17:53266\",\"http://46.101.87.17:49312\",\"http://46.101.73.204:53815\",\"http://46.101.73.204:59201\",\"http://46.101.73.204:51628\",\"http://167.99.88.239:63133\",\"http://46.101.73.204:62943\",\"http://139.59.188.51:50248\",\"http://139.59.188.51:52117\",\"http://139.59.188.51:51354\",\"http://139.59.188.51:63328\",\"http://139.59.184.251:64176\",\"http://139.59.184.251:49919\",\"http://139.59.184.251:65233\",\"http://139.59.184.251:50106\",\"http://139.59.186.151:59980\",\"http://167.99.86.2:51734\",\"http://139.59.186.151:54456\",\"http://139.59.186.151:60074\",\"http://139.59.186.151:49485\",\"http://139.59.181.9:63874\",\"http://139.59.181.9:64551\",\"http://139.59.181.9:54254\",\"http://139.59.181.9:61388\",\"http://139.59.165.140:51270\",\"http://139.59.165.140:53257\",\"http://139.59.165.140:61181\",\"http://167.99.86.2:60865\",\"http://139.59.165.140:64912\",\"http://46.101.86.57:60578\",\"http://46.101.86.57:58405\",\"http://46.101.86.57:50798\",\"http://46.101.86.57:63638\",\"http://139.59.180.45:61771\",\"http://139.59.180.45:53017\",\"http://139.59.180.45:61057\",\"http://139.59.180.45:49679\",\"http://139.59.173.24:58710\",\"http://167.99.86.2:54157\",\"http://139.59.173.24:53688\",\"http://139.59.173.24:62624\",\"http://139.59.173.24:61050\",\"http://139.59.171.3:51570\",\"http://139.59.171.3:58917\",\"http://139.59.171.3:56058\",\"http://139.59.171.3:52237\",\"http://139.59.184.184:55537\",\"http://139.59.184.184:65008\",\"http://139.59.184.184:52902\",\"http://167.99.86.2:58996\",\"http://139.59.184.184:50006\",\"http://46.101.75.208:49316\",\"http://192.168.1.10:58968\",\"http://192.168.1.10:62228\",\"http://192.168.1.10:53318\",\"http://192.168.1.10:60885\",\"http://188.241.118.9:58786\",\"http://188.241.118.9:62786\",\"http://188.241.118.9:63440\",\"http://188.241.118.9:57626\",\"http://93.174.166.250:64545\",\"http://93.174.166.250:62949\",\"http://93.174.166.250:53982\",\"http://93.174.166.250:65051\",\"http://93.174.166.250:64668\",\"http://93.174.166.250:63093\",\"http://93.174.166.250:50421\",\"http://93.174.166.250:59269\",\"http://93.174.166.250:60171\",\"http://93.174.166.250:60988\",\"http://93.174.166.250:63254\",\"http://93.174.166.250:61625\",\"http://46.101.36.85:49982\",\"http://46.101.36.85:60410\",\"http://46.101.36.85:55678\",\"http://46.101.36.85:61763\",\"http://46.101.36.85:52716\",\"http://46.101.36.85:49348\",\"http://46.101.36.85:64540\",\"http://46.101.36.85:64498\",\"http://46.101.36.85:50176\",\"http://46.101.36.85:63830\",\"http://46.101.36.85:59891\",\"http://46.101.36.85:50838\",\"http://46.101.36.85:60660\",\"http://46.101.36.85:52715\",\"http://46.101.36.85:49223\",\"http://46.101.36.85:59562\",\"http://188.241.118.10:55390\",\"http://188.241.118.23:53296\",\"http://188.241.118.23:63467\",\"http://188.241.118.23:50604\",\"http://188.241.118.5:50852\",\"http://188.241.118.5:52514\",\"http://188.241.118.5:59073\",\"http://188.241.118.5:63692\",\"http://188.241.118.11:54268\",\"http://188.241.118.11:50675\",\"http://188.241.118.11:64090\",\"http://188.241.118.10:54350\",\"http://188.241.118.11:64991\",\"http://188.241.118.235:55863\",\"http://188.241.118.235:49652\",\"http://188.241.118.235:49592\",\"http://188.241.118.235:51921\",\"http://188.241.118.175:56336\",\"http://188.241.118.175:53216\",\"http://188.241.118.175:63466\",\"http://188.241.118.175:63172\",\"http://188.241.118.182:57189\",\"http://188.241.118.10:57690\",\"http://188.241.118.182:60857\",\"http://188.241.118.182:64886\",\"http://188.241.118.182:50732\",\"http://188.241.118.240:60365\",\"http://188.241.118.240:52567\",\"http://188.241.118.240:65162\",\"http://188.241.118.240:60537\",\"http://188.241.118.145:60433\",\"http://188.241.118.145:64717\",\"http://188.241.118.145:61269\",\"http://188.241.118.10:52352\",\"http://188.241.118.145:62476\",\"http://188.241.118.7:51498\",\"http://188.241.118.7:64408\",\"http://188.241.118.7:58904\",\"http://188.241.118.7:54596\",\"http://188.241.118.23:63118\",\"http://46.101.251.14:63989\",\"http://46.101.233.37:60526\",\"http://46.101.233.37:54928\",\"http://46.101.233.37:59956\",\"http://46.101.233.37:56233\",\"http://46.101.233.37:49157\",\"http://46.101.233.37:52916\",\"http://46.101.233.37:63413\",\"http://46.101.242.65:60834\",\"http://46.101.242.65:59797\",\"http://46.101.242.65:50407\",\"http://46.101.251.14:58804\",\"http://46.101.242.65:59146\",\"http://46.101.242.65:53446\",\"http://46.101.242.65:64885\",\"http://46.101.242.65:62390\",\"http://46.101.242.65:50845\",\"http://46.101.242.221:54234\",\"http://46.101.242.221:52626\",\"http://46.101.242.221:61336\",\"http://46.101.242.221:60107\",\"http://46.101.242.221:57417\",\"http://46.101.251.14:62387\",\"http://46.101.242.221:60520\",\"http://46.101.242.221:60687\",\"http://46.101.242.221:56455\",\"http://46.101.237.193:59804\",\"http://46.101.237.193:51528\",\"http://46.101.237.193:62429\",\"http://46.101.237.193:59870\",\"http://46.101.237.193:63428\",\"http://46.101.237.193:53749\",\"http://46.101.237.193:53521\",\"http://46.101.251.14:63968\",\"http://46.101.237.193:53805\",\"http://46.101.110.101:63818\",\"http://46.101.110.101:49483\",\"http://46.101.110.101:63749\",\"http://46.101.110.101:51111\",\"http://46.101.110.101:63203\",\"http://46.101.110.101:54610\",\"http://46.101.110.101:57718\",\"http://46.101.110.101:53918\",\"http://46.101.112.139:62615\",\"http://46.101.251.14:53156\",\"http://46.101.112.139:57914\",\"http://46.101.112.139:62692\",\"http://46.101.112.139:65258\",\"http://46.101.112.139:51745\",\"http://46.101.112.139:60908\",\"http://46.101.112.139:55562\",\"http://46.101.112.139:59492\",\"http://46.101.239.4:59255\",\"http://46.101.239.4:65409\",\"http://46.101.239.4:52135\",\"http://46.101.251.14:58115\",\"http://46.101.239.4:56833\",\"http://46.101.239.4:57473\",\"http://46.101.239.4:62814\",\"http://46.101.239.4:62223\",\"http://46.101.239.4:49923\",\"http://46.101.104.90:55935\",\"http://46.101.104.90:61133\",\"http://46.101.104.90:64189\",\"http://46.101.104.90:49560\",\"http://46.101.104.90:64814\",\"http://46.101.251.14:53796\",\"http://46.101.104.90:58809\",\"http://46.101.104.90:60442\",\"http://46.101.104.90:56939\",\"http://46.101.246.11:65356\",\"http://46.101.246.11:59771\",\"http://46.101.246.11:52889\",\"http://46.101.246.11:53079\",\"http://46.101.246.11:59167\",\"http://46.101.246.11:51445\",\"http://46.101.246.11:61682\",\"http://46.101.251.14:56064\",\"http://46.101.246.11:53802\",\"http://46.101.233.37:56177\"]";

    nodes = JSON.parse(nodes);

    var amounts = [];
    var wallets = [];
    var big_added = false;

    $('#wallets').hide();

    function printwallets() {
      $('#wallets').val(JSON.stringify(wallets));
      $('#wallets').show();
    }

    function getwallets() {
      $.each(nodes, function(index, node) {
        var wallet = node + '/__wallet';

        $.getJSON(wallet, (function(link) {
          return function(data) {
            // Older versions use a different format
            if (data.data) {
              data = data.data;
            }

            wallets.push(data);
          }
        })(node));
      });
    }

    function getbalances() {
      $.each(nodes, function(index, node) {
        var wallet = node + '/balance';

        $.getJSON(wallet, (function(link) {
          return function(data) {
            amounts.push(data);
          }
        })(node));
      });
    }

    function getbalances2() {
      var calls = [];

      $.each(nodes, function(index, node) {
        var balance = node + '/balance';

        calls.push(function(callback) {
          $.getJSON(balance, function(data) {
            callback(null, {
              node: node,
              data: data
            });
          });
        });
      });

      async.parallel(calls, function(err, results) {
        $.getJSON('http://46.101.36.85:49982/power', function(data) {
          var global_power = parseInt(data.global) / 1000;

          $.each(results, function(index, result) {
            amounts.push(result.data);

            if (result.data.miner) {
              alert('old');
            }

            $.getJSON(result.node, (function(data) {
              return function(data2) {
                var port = result.node.split(':');
                port = port[2];
                port = port.substr(0, port.length - 1);

                table.row.add([
                  '<a href="' + result.node + '" target="_blank">' + result.node + '</a>',
                  '<a href="' + result.node + 'balance" target="_blank">' + numeral(data).format('0,0') + '</a>',
                  numeral(data2.blocks.length).format('0,0')
                ]).draw(false);
              }
            })(result.data));
          });

          var power = amounts.length * 600 / 1000;
          var block_time = 40;
          var reward_block = 6000;
          var dominance = power / global_power * 100;
          var reward_24 = reward_block * 60 * 60 * 24 / block_time * dominance / 100;
          var reward_24_usd = reward_24 * 0.001;
          var cost_24_usd = 0;
          cost_24_usd += 0.238 * 10 * 24; // do
          cost_24_usd += 0.119 * 20 * 24; // do
          cost_24_usd += 0.808 * 1 * 24; // aws
          cost_24_usd += 0.06 * 20 * 24; // vps

          var roi_24 = reward_24_usd / cost_24_usd * 100;
          var block_mining_time = 100 / dominance * block_time;
          var current_time = new Date();
          current_time = current_time.getHours() + ':' + current_time.getMinutes();

          $('#sum').html(numeral(ss.sum(amounts)).format('0,0'));
          $('#mean').html(numeral(ss.mean(amounts)).format('0,0'));
          $('#median').html(numeral(ss.medianSorted(amounts)).format('0,0'));
          $('#power').html(numeral(power).format('0,0'));
          $('#global_power').html(numeral(global_power).format('0,0'));
          $('#dominance').html(parseInt(dominance));
          $('#block_time').html(block_time);
          $('#reward_24').html(numeral(reward_24).format('0,0'));
          $('#reward_24_usd').html(numeral(reward_24_usd).format('0,0'));
          $('#roi_24').html(numeral(roi_24).format('0,0'));
          $('#cost_24_usd').html(numeral(cost_24_usd).format('0,0'));
          $('#block_mining_time').html(numeral(block_mining_time).format('0,0'));
          $('#block_mining_time_minutes').html(numeral(block_mining_time / 60).format('0,0'));
          $('#current_time').html(current_time);
        });
      });
    }

    $(document).ready(function() {
      table = $('#nodes').DataTable({
        'pageLength': 100
      });
      getbalances2();
    });
  </script>
</body>

</html>
